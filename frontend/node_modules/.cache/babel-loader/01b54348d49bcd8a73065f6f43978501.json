{"ast":null,"code":"import _regeneratorRuntime from\"/Users/naringles/Desktop/OneStorage/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/naringles/Desktop/OneStorage/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _toConsumableArray from\"/Users/naringles/Desktop/OneStorage/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/Users/naringles/Desktop/OneStorage/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect,useContext}from\"react\";import axios from\"axios\";import{useHistory}from\"react-router-dom\";import{LoginContext}from\"./LoginContext\";import{FilesContext}from\"./FilesRepo\";import Progress from\"./UploadProgressBar\";import{Modal}from\"react-bootstrap\";function FileUpload(props){console.log(\"props.show is :\",props.show);var _useContext=useContext(LoginContext),_useContext2=_slicedToArray(_useContext,2),loggedIn=_useContext2[0],setLoggedIn=_useContext2[1];var _useContext3=useContext(FilesContext),files=_useContext3.files,setFiles=_useContext3.setFiles;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),upFiles=_useState2[0],setUpFiles=_useState2[1];var _useState3=useState([\"Choose Files(s)\"]),_useState4=_slicedToArray(_useState3,2),fileNames=_useState4[0],setFileNames=_useState4[1];var _useState5=useState(0),_useState6=_slicedToArray(_useState5,2),uploadPct=_useState6[0],setUploadPct=_useState6[1];var _useState7=useState(props.show),_useState8=_slicedToArray(_useState7,2),show=_useState8[0],setShow=_useState8[1];var _useState9=useState([\"Note:\"]),_useState10=_slicedToArray(_useState9,2),messages=_useState10[0],setMessage=_useState10[1];var handleClose=function handleClose(){setShow(false);props.handleClose();setMessage([\"Note: \"]);setFileNames([\"Choose Files(s)\"]);setUpFiles([]);};var handleChange=function handleChange(e){setMessage([\"Note: \"]);setUpFiles(e.target.files);setFileNames(_toConsumableArray(e.target.files).map(function(file){return file.name;}));};useEffect(function(){fileNames.map(function(fname){files.map(function(file){if(file.fileName===fname){setMessage(function(prevMsg){return _toConsumableArray(new Set([].concat(_toConsumableArray(prevMsg),[\"A file with \".concat(fname,\" already exists, do you want upload this again?\")])));});}});});},[fileNames]);var handleSubmit=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var formData,i,upFile,res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.preventDefault();console.log(\"files: \",upFiles);console.log(\"file names: \",fileNames);formData=new FormData();for(i=0;i<upFiles.length;i++){upFile=upFiles.item(i);formData.append(\"file\",upFile);}// formData.append('uploadFiles', files);\n// });\nconsole.log(\"formData: \",formData);_context.prev=6;_context.next=9;return axios.post(\"/action/upload/multiple\",formData,{headers:{\"Content-Type\":\"multipart/form-data\"},onUploadProgress:function onUploadProgress(progressEvent){setUploadPct(parseInt(Math.round(progressEvent.loaded*100/progressEvent.total)));setTimeout(function(){return setUploadPct(0);},10000);}});case 9:res=_context.sent;// const { fileName, filePath } = res.data;\n// setUploadedFile({ fileName, filePath });\nconsole.log(\"File Uploaded : \",res.data);setFileNames([\"Choose Files(s)\"]);setUpFiles([]);setMessage([\"Note: \"]);_context.next=20;break;case 16:_context.prev=16;_context.t0=_context[\"catch\"](6);// if (err.response.status === 500) {\nconsole.log(\"There was a problem with the server\");// } else {\nconsole.log(_context.t0.response.data.msg);// }\ncase 20:case\"end\":return _context.stop();}}},_callee,null,[[6,16]]);}));return function handleSubmit(_x){return _ref.apply(this,arguments);};}();useEffect(function(){setShow(props.show);},[props.show]);return/*#__PURE__*/React.createElement(Modal,{show:show,onHide:handleClose,backdrop:\"static\",keyboard:false},/*#__PURE__*/React.createElement(Modal.Header,{closeButton:true},/*#__PURE__*/React.createElement(Modal.Title,null,\"\\uC5C5\\uB85C\\uB4DC\\uD560 \\uD30C\\uC77C\\uC744 \\uC120\\uD0DD\\uD574 \\uC8FC\\uC138\\uC694.\")),/*#__PURE__*/React.createElement(\"form\",{onSubmit:handleSubmit},/*#__PURE__*/React.createElement(Modal.Body,null,/*#__PURE__*/React.createElement(\"div\",{className:\"custom-file mb-4\"},/*#__PURE__*/React.createElement(\"input\",{type:\"file\",className:\"custom-file-input\",id:\"customFile\",onChange:handleChange,multiple:true}),/*#__PURE__*/React.createElement(\"label\",{style:{overflowY:\"hidden\"},className:\"custom-file-label\",htmlFor:\"customFile\"},fileNames.map(function(fName,index){return/*#__PURE__*/React.createElement(\"span\",{key:index},fName,\" \");})))),/*#__PURE__*/React.createElement(Modal.Footer,null,messages.length>1?/*#__PURE__*/React.createElement(\"div\",{style:{backgroundColor:\"#440c05\",color:\"#fff\",padding:\"2%\"}},messages.map(function(msg,index){return/*#__PURE__*/React.createElement(\"p\",{key:index},msg);})):null,/*#__PURE__*/React.createElement(Progress,{percentage:uploadPct}),/*#__PURE__*/React.createElement(\"input\",{type:\"submit\",value:\"Upload\",className:\"btn btn-primary btn-block mt-4\"}))));}export default FileUpload;","map":{"version":3,"sources":["/Users/naringles/Desktop/OneStorage/frontend/src/components/FileUpload.jsx"],"names":["React","useState","useEffect","useContext","axios","useHistory","LoginContext","FilesContext","Progress","Modal","FileUpload","props","console","log","show","loggedIn","setLoggedIn","files","setFiles","upFiles","setUpFiles","fileNames","setFileNames","uploadPct","setUploadPct","setShow","messages","setMessage","handleClose","handleChange","e","target","map","file","name","fname","fileName","prevMsg","Set","handleSubmit","preventDefault","formData","FormData","i","length","upFile","item","append","post","headers","onUploadProgress","progressEvent","parseInt","Math","round","loaded","total","setTimeout","res","data","response","msg","overflowY","fName","index","backgroundColor","color","padding"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useContext } from \"react\";\nimport axios from \"axios\";\nimport { useHistory } from \"react-router-dom\";\nimport { LoginContext } from \"./LoginContext\";\n\nimport { FilesContext } from \"./FilesRepo\";\nimport Progress from \"./UploadProgressBar\";\nimport { Modal } from \"react-bootstrap\";\nfunction FileUpload(props) {\n  console.log(\"props.show is :\", props.show);\n  const [loggedIn, setLoggedIn] = useContext(LoginContext);\n  const { files, setFiles } = useContext(FilesContext);\n  const [upFiles, setUpFiles] = useState([]);\n  const [fileNames, setFileNames] = useState([\"Choose Files(s)\"]);\n  const [uploadPct, setUploadPct] = useState(0);\n  const [show, setShow] = useState(props.show);\n  const [messages, setMessage] = useState([\"Note:\"]);\n  const handleClose = () => {\n    setShow(false);\n    props.handleClose();\n    setMessage([\"Note: \"]);\n    setFileNames([\"Choose Files(s)\"]);\n    setUpFiles([]);\n  };\n  const handleChange = (e) => {\n    setMessage([\"Note: \"]);\n    setUpFiles(e.target.files);\n    setFileNames([...e.target.files].map((file) => file.name));\n  };\n  useEffect(() => {\n    fileNames.map((fname) => {\n      files.map((file) => {\n        if (file.fileName === fname) {\n          setMessage((prevMsg) => [\n            ...new Set([\n              ...prevMsg,\n              `A file with ${fname} already exists, do you want upload this again?`,\n            ]),\n          ]);\n        }\n      });\n    });\n  }, [fileNames]);\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    console.log(\"files: \", upFiles);\n    console.log(\"file names: \", fileNames);\n\n    const formData = new FormData();\n    for (var i = 0; i < upFiles.length; i++) {\n      let upFile = upFiles.item(i);\n      formData.append(\"file\", upFile);\n    }\n    // formData.append('uploadFiles', files);\n    // });\n    console.log(\"formData: \", formData);\n\n    try {\n      const res = await axios.post(\"/action/upload/multiple\", formData, {\n        headers: {\n          \"Content-Type\": \"multipart/form-data\",\n        },\n        onUploadProgress: (progressEvent) => {\n          setUploadPct(\n            parseInt(\n              Math.round((progressEvent.loaded * 100) / progressEvent.total)\n            )\n          );\n          setTimeout(() => setUploadPct(0), 10000);\n        },\n      });\n\n      // const { fileName, filePath } = res.data;\n\n      // setUploadedFile({ fileName, filePath });\n\n      console.log(\"File Uploaded : \", res.data);\n      setFileNames([\"Choose Files(s)\"]);\n      setUpFiles([]);\n      setMessage([\"Note: \"]);\n    } catch (err) {\n      // if (err.response.status === 500) {\n      console.log(\"There was a problem with the server\");\n      // } else {\n      console.log(err.response.data.msg);\n      // }\n    }\n  };\n  useEffect(() => {\n    setShow(props.show);\n  }, [props.show]);\n\n  return (\n    <Modal show={show} onHide={handleClose} backdrop=\"static\" keyboard={false}>\n      <Modal.Header closeButton>\n        <Modal.Title>업로드할 파일을 선택해 주세요.</Modal.Title>\n      </Modal.Header>\n\n      <form onSubmit={handleSubmit}>\n        <Modal.Body>\n          <div className=\"custom-file mb-4\">\n            <input\n              type=\"file\"\n              className=\"custom-file-input\"\n              id=\"customFile\"\n              onChange={handleChange}\n              multiple\n            />\n            <label\n              style={{ overflowY: \"hidden\" }}\n              className=\"custom-file-label\"\n              htmlFor=\"customFile\"\n            >\n              {fileNames.map((fName, index) => (\n                <span key={index}>{fName} </span>\n              ))}\n            </label>\n          </div>\n        </Modal.Body>\n        <Modal.Footer>\n          {messages.length > 1 ? (\n            <div\n              style={{\n                backgroundColor: \"#440c05\",\n                color: \"#fff\",\n                padding: \"2%\",\n              }}\n            >\n              {messages.map((msg, index) => (\n                <p key={index}>{msg}</p>\n              ))}\n            </div>\n          ) : null}\n          <Progress percentage={uploadPct} />\n          <input\n            type=\"submit\"\n            value=\"Upload\"\n            className=\"btn btn-primary btn-block mt-4\"\n          />\n        </Modal.Footer>\n      </form>\n    </Modal>\n  );\n}\n\nexport default FileUpload;\n"]},"metadata":{},"sourceType":"module"}