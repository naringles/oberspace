{"ast":null,"code":"import _regeneratorRuntime from\"/Users/naringles/Desktop/OneStorage/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/naringles/Desktop/OneStorage/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/naringles/Desktop/OneStorage/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect,useContext,Component}from\"react\";import Header from\"./Header\";import Footer from\"./Footer\";import axios from\"axios\";import{useHistory}from\"react-router-dom\";import{LoginContext}from\"./LoginContext\";import{DrivesContext,DriveDeleteContext}from\"./DrivesRepo\";import{DarkContext}from\"./SearchContext\";import{FilesContext}from\"./FilesRepo\";import FileList from\"./FileList\";import DriveList from\"./DriveList\";import AddDrives from\"./AddDrives\";import FileUpload from\"./FileUpload\";import classNames from\"classnames\";import _ from\"lodash\";import sockIO from\"socket.io-client\";function Home(_ref){var match=_ref.match;var backEndPort=\"http://localhost:3000\";// let backEndPort;\n// if (process.env.NODE_ENV === \"production\") {\n//   backEndPort = \"https://desolate-bastion-47247.herokuapp.com/\";\n// } else {\n//   backEndPort = \"http://localhost:3000\";\n// }\nvar customSwitchClass=classNames(\"custom-control\",\"custom-switch\");var mimeSuffixName=[\"octet-stream\",\"vnd.google-apps.spreadsheet\",\"vnd.google-apps.document\",\"vnd.google-apps.presentation\",\"pdf\"];var mimeSuffixValue=[\"Plain\",\"Spreadsheet\",\"WordDocument\",\"PowerPoint\",\"PDF\"];var mimeSuffixMappings=new Object();useEffect(function(){mimeSuffixName.forEach(function(item,index){mimeSuffixMappings[item]=mimeSuffixValue[index];});},[]);useEffect(function(){var socketIO;console.log(\"environment :\",process.env.NODE_ENV);// if (process.env.NODE_ENV === \"production\") {\n//   socketIO = sockIO.connect();\n// } else {\n//   socketIO = sockIO.connect(backEndPort);\n// }\nsocketIO=sockIO.connect(backEndPort);console.log(\"socket is :\",socketIO);socketIO.on(\"oneDriveFiles\",function(data){console.log(\"Incoming onedriveFiles:\",data.files.filter(function(file){return new Date(file.createdAt)>=new Date(JSON.parse(sessionStorage.lastFetchDt));}));// console.log(\"lastFetchedDt\",JSON.parse(sessionStorage.getItem(\"lastFetchDt\")));\nsetFiles(function(oldFiles){return _.unionBy(data.files.filter(function(file){return new Date(file.createdAt)>=new Date(JSON.parse(sessionStorage.lastFetchDt));}),oldFiles,\"fileId\");});});socketIO.on(\"dbxFiles\",function(data){console.log(\"Incoming dbxFiles:\",data.files.filter(function(file){return new Date(file.createdAt)>=new Date(JSON.parse(sessionStorage.lastFetchDt));}));// console.log(\"last fetch dt\",JSON.parse(sessionStorage.lastFetchDt));\nsetFiles(function(oldFiles){return _.unionBy(data.files.filter(function(file){return new Date(file.createdAt)>=new Date(JSON.parse(sessionStorage.lastFetchDt));}),oldFiles,\"fileId\");});});socketIO.on(\"googleFiles\",function(data){console.log(\"Incoming googleFiles:\",data.files.filter(function(file){return new Date(file.createdAt)>=new Date(JSON.parse(sessionStorage.lastFetchDt));}));setFiles(function(oldFiles){return _.unionBy(data.files.filter(function(file){return new Date(file.createdAt)>=new Date(JSON.parse(sessionStorage.lastFetchDt));}),oldFiles,\"fileId\");});});},[]);var history=useHistory();// if (window.location.hash === \"#_=_\") {\n//   history.replaceState\n//     ? history.replaceState(null, null, window.location.href.split(\"#\")[0])\n//     : (window.location.hash = \"\");\n// }\nvar _useState=useState({status:false,type:\"\",email:\"\",message:\"\"}),_useState2=_slicedToArray(_useState,2),driveAdded=_useState2[0],setDriveAdded=_useState2[1];var _useContext=useContext(DriveDeleteContext),driveDeleted=_useContext.driveDeleted,setDriveDeleted=_useContext.setDriveDeleted;var _useContext2=useContext(DarkContext),darkMode=_useContext2.darkMode,setDarkMode=_useContext2.setDarkMode;useEffect(function(){var queryString=window.location.search;console.log(\"queryString:\",queryString);if(typeof queryString!==undefined&&queryString!==\"\"){var urlParams=new URLSearchParams(queryString);if(urlParams.get(\"success\")===\"true\"){console.log(\"status is: \",urlParams.get(\"success\"));console.log(\"attempt is: \",urlParams.get(\"attempt\"));console.log(\"message : \",urlParams.get(\"message\"));if(urlParams.get(\"attempt\").includes(\"add\")){console.log(\"new Drive is: \",urlParams.get(\"newDrive\"));console.log(\"new Drive type is: \",urlParams.get(\"newDriveType\"));setDriveAdded({status:true,type:urlParams.get(\"newDriveType\"),email:urlParams.get(\"newDrive\"),message:urlParams.get(\"message\")});}}else{console.log(\"status is: \",urlParams.get(\"success\"));console.log(\"status is: \",urlParams.get(\"attempt\"));console.log(\"message : \",urlParams.get(\"message\"));if(urlParams.get(\"attempt\").includes(\"add\")){setDriveAdded({status:false,type:\"NA\",email:\"NA\",message:urlParams.get(\"message\")});}}setTimeout(function(){return setDriveAdded({status:false,type:\"\",email:\"\",message:\"\"});},10000);window.history.replaceState({},null,window.location.href.split(\"?\")[0]);}console.log(\"dark mode: \",darkMode);if(darkMode){var elements=document.querySelectorAll(\"body,.card,.list-group-item,.tooltiptext\");elements.forEach(function(element){element.style.backgroundColor=\"#000\";element.style.color=\"#fff\";});}else{var elements=document.querySelectorAll(\"body,.card,.list-group-item,.tooltiptext\");elements.forEach(function(element){element.style.backgroundColor=\"#fff\";element.style.color=\"#000\";});}console.log(\"dark mode: \",darkMode);if(darkMode){var elements=document.querySelectorAll(\"body,.card,.list-group-item,.tooltiptext\");elements.forEach(function(element){element.style.backgroundColor=\"#000\";element.style.color=\"#fff\";});}else{var elements=document.querySelectorAll(\"body,.card,.list-group-item,.tooltiptext\");elements.forEach(function(element){element.style.backgroundColor=\"#fff\";element.style.color=\"#000\";});}},[]);var _useContext3=useContext(DrivesContext),drives=_useContext3.drives,setDrives=_useContext3.setDrives;var _useContext4=useContext(FilesContext),files=_useContext4.files,setFiles=_useContext4.setFiles;var _useContext5=useContext(LoginContext),_useContext6=_slicedToArray(_useContext5,2),loggedIn=_useContext6[0],setLoggedIn=_useContext6[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),showUpload=_useState4[0],setShow=_useState4[1];console.log(\" user home page\");// const { params: { userName } = {} } = match;\nuseEffect(function(){axios.get(\"/user/data/read\",{withCredentials:true}).then(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(response){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:sessionStorage.setItem(\"lastFetchDt\",JSON.stringify(new Date()));if(response.data.success){console.log(\"response: \",response.data);if(response.data.drives.length>0){setDrives(response.data.drives);// console.log(\"files received:\",response.data.drives.map(({ files }) => files).flat());\nsetFiles(response.data.drives.map(function(_ref3){var files=_ref3.files;return files;}).flat().sort(function(a,b){return new Date(b.createdAt)-new Date(a.createdAt);}).map(function(file){if(file.fileFolderType.includes(\"undefined\")){var mimeSuffArr=file.mimeType.split(\"/\");var mimeSuff=mimeSuffArr[mimeSuffArr.length-1].toLowerCase();if(typeof mimeSuffixMappings[mimeSuff]!==\"undefined\"){file.fileFolderType=mimeSuffixMappings[mimeSuff];}else{file.fileFolderType=\"Others\";}}return file;}));}else{setDrives([]);}}else{history.push(\"/\");}case 2:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref2.apply(this,arguments);};}()).catch(function(error){console.log(error);});},[]);var triggerUpload=function triggerUpload(){setShow(true);};var handleUploadModalClose=function handleUploadModalClose(){setShow(false);};return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Header,null),loggedIn.status&&/*#__PURE__*/React.createElement(\"div\",{className:\"container-fluid\"},/*#__PURE__*/React.createElement(\"div\",{className:\"row\",style:{paddingTop:\"2%\"}},/*#__PURE__*/React.createElement(\"div\",{className:\"col-sm-2\",style:{padding:\"0\"}},/*#__PURE__*/React.createElement(DriveList,null)),/*#__PURE__*/React.createElement(\"div\",{className:\"col-sm-8\"},/*#__PURE__*/React.createElement(FileList,null),/*#__PURE__*/React.createElement(\"br\",null),driveAdded.status?/*#__PURE__*/React.createElement(\"p\",{style:{backgroundColor:\"green\",color:\"#fff\",fontSize:\"medium\",margin:\"2%\",padding:\"2%\"}},\" \",driveAdded.type,\" drive (\",driveAdded.email,\") added successfully\"):driveAdded.message.length>0?/*#__PURE__*/React.createElement(\"p\",{style:{backgroundColor:\"red\",color:\"#fff\",fontSize:\"medium\",margin:\"2%\",padding:\"2%\"}},\" \",driveAdded.message):null,/*#__PURE__*/React.createElement(\"br\",null),driveDeleted.status?/*#__PURE__*/React.createElement(\"p\",{style:{backgroundColor:\"green\",color:\"#fff\",fontSize:\"medium\",margin:\"2%\",padding:\"2%\"}},\" \",\"Drive removed successfully\"):driveDeleted.message.length>0?/*#__PURE__*/React.createElement(\"p\",{style:{backgroundColor:\"red\",color:\"#fff\",fontSize:\"medium\",margin:\"2%\",padding:\"2%\"}},\" \",driveDeleted.message):null),/*#__PURE__*/React.createElement(\"div\",{className:\"col-sm-2\"},/*#__PURE__*/React.createElement(AddDrives,null),/*#__PURE__*/React.createElement(\"div\",{className:\"cardHeader\",style:{marginTop:\"2%\"}},/*#__PURE__*/React.createElement(\"button\",{className:\"uploadButton\",onClick:triggerUpload},\" \",\"Upload File\")),/*#__PURE__*/React.createElement(FileUpload,{show:showUpload,handleClose:handleUploadModalClose})))),/*#__PURE__*/React.createElement(Footer,null));}export default Home;","map":{"version":3,"sources":["/Users/naringles/Desktop/OneStorage/frontend/src/components/UserHome.jsx"],"names":["React","useState","useEffect","useContext","Component","Header","Footer","axios","useHistory","LoginContext","DrivesContext","DriveDeleteContext","DarkContext","FilesContext","FileList","DriveList","AddDrives","FileUpload","classNames","_","sockIO","Home","match","backEndPort","customSwitchClass","mimeSuffixName","mimeSuffixValue","mimeSuffixMappings","Object","forEach","item","index","socketIO","console","log","process","env","NODE_ENV","connect","on","data","files","filter","file","Date","createdAt","JSON","parse","sessionStorage","lastFetchDt","setFiles","oldFiles","unionBy","history","status","type","email","message","driveAdded","setDriveAdded","driveDeleted","setDriveDeleted","darkMode","setDarkMode","queryString","window","location","search","undefined","urlParams","URLSearchParams","get","includes","setTimeout","replaceState","href","split","elements","document","querySelectorAll","element","style","backgroundColor","color","drives","setDrives","loggedIn","setLoggedIn","showUpload","setShow","withCredentials","then","response","setItem","stringify","success","length","map","flat","sort","a","b","fileFolderType","mimeSuffArr","mimeType","mimeSuff","toLowerCase","push","catch","error","triggerUpload","handleUploadModalClose","paddingTop","padding","fontSize","margin","marginTop"],"mappings":"seAAA,MAAOA,CAAAA,KAAP,EAAgBC,QAAhB,CAA0BC,SAA1B,CAAqCC,UAArC,CAAiDC,SAAjD,KAAkE,OAAlE,CACA,MAAOC,CAAAA,MAAP,KAAmB,UAAnB,CACA,MAAOC,CAAAA,MAAP,KAAmB,UAAnB,CACA,MAAOC,CAAAA,KAAP,KAAkB,OAAlB,CACA,OAASC,UAAT,KAA2B,kBAA3B,CACA,OAASC,YAAT,KAA6B,gBAA7B,CACA,OAASC,aAAT,CAAwBC,kBAAxB,KAAkD,cAAlD,CACA,OAASC,WAAT,KAA4B,iBAA5B,CACA,OAASC,YAAT,KAA6B,aAA7B,CACA,MAAOC,CAAAA,QAAP,KAAqB,YAArB,CACA,MAAOC,CAAAA,SAAP,KAAsB,aAAtB,CACA,MAAOC,CAAAA,SAAP,KAAsB,aAAtB,CACA,MAAOC,CAAAA,UAAP,KAAuB,cAAvB,CACA,MAAOC,CAAAA,UAAP,KAAuB,YAAvB,CACA,MAAOC,CAAAA,CAAP,KAAc,QAAd,CACA,MAAOC,CAAAA,MAAP,KAAmB,kBAAnB,CAEA,QAASC,CAAAA,IAAT,MAAyB,IAATC,CAAAA,KAAS,MAATA,KAAS,CACvB,GAAMC,CAAAA,WAAW,CAAG,uBAApB,CACA;AACA;AACA;AACA;AACA;AACA;AAEA,GAAMC,CAAAA,iBAAiB,CAAGN,UAAU,CAAC,gBAAD,CAAmB,eAAnB,CAApC,CACA,GAAMO,CAAAA,cAAc,CAAG,CACrB,cADqB,CAErB,6BAFqB,CAGrB,0BAHqB,CAIrB,8BAJqB,CAKrB,KALqB,CAAvB,CAOA,GAAMC,CAAAA,eAAe,CAAG,CACtB,OADsB,CAEtB,aAFsB,CAGtB,cAHsB,CAItB,YAJsB,CAKtB,KALsB,CAAxB,CAOA,GAAMC,CAAAA,kBAAkB,CAAG,GAAIC,CAAAA,MAAJ,EAA3B,CAEA1B,SAAS,CAAC,UAAM,CACduB,cAAc,CAACI,OAAf,CAAuB,SAACC,IAAD,CAAOC,KAAP,CAAiB,CACtCJ,kBAAkB,CAACG,IAAD,CAAlB,CAA2BJ,eAAe,CAACK,KAAD,CAA1C,CACD,CAFD,EAGD,CAJQ,CAIN,EAJM,CAAT,CAMA7B,SAAS,CAAC,UAAM,CACd,GAAI8B,CAAAA,QAAJ,CACAC,OAAO,CAACC,GAAR,CAAY,eAAZ,CAA6BC,OAAO,CAACC,GAAR,CAAYC,QAAzC,EACA;AACA;AACA;AACA;AACA;AACAL,QAAQ,CAAGZ,MAAM,CAACkB,OAAP,CAAef,WAAf,CAAX,CACAU,OAAO,CAACC,GAAR,CAAY,aAAZ,CAA2BF,QAA3B,EACAA,QAAQ,CAACO,EAAT,CAAY,eAAZ,CAA6B,SAAUC,IAAV,CAAgB,CAC3CP,OAAO,CAACC,GAAR,CACE,yBADF,CAEEM,IAAI,CAACC,KAAL,CAAWC,MAAX,CACE,SAACC,IAAD,QACE,IAAIC,CAAAA,IAAJ,CAASD,IAAI,CAACE,SAAd,GACA,GAAID,CAAAA,IAAJ,CAASE,IAAI,CAACC,KAAL,CAAWC,cAAc,CAACC,WAA1B,CAAT,CAFF,EADF,CAFF,EAQA;AACAC,QAAQ,CAAC,SAACC,QAAD,QACPhC,CAAAA,CAAC,CAACiC,OAAF,CACEZ,IAAI,CAACC,KAAL,CAAWC,MAAX,CACE,SAACC,IAAD,QACE,IAAIC,CAAAA,IAAJ,CAASD,IAAI,CAACE,SAAd,GACA,GAAID,CAAAA,IAAJ,CAASE,IAAI,CAACC,KAAL,CAAWC,cAAc,CAACC,WAA1B,CAAT,CAFF,EADF,CADF,CAMEE,QANF,CAOE,QAPF,CADO,EAAD,CAAR,CAWD,CArBD,EAsBAnB,QAAQ,CAACO,EAAT,CAAY,UAAZ,CAAwB,SAAUC,IAAV,CAAgB,CACtCP,OAAO,CAACC,GAAR,CACE,oBADF,CAEEM,IAAI,CAACC,KAAL,CAAWC,MAAX,CACE,SAACC,IAAD,QACE,IAAIC,CAAAA,IAAJ,CAASD,IAAI,CAACE,SAAd,GACA,GAAID,CAAAA,IAAJ,CAASE,IAAI,CAACC,KAAL,CAAWC,cAAc,CAACC,WAA1B,CAAT,CAFF,EADF,CAFF,EAQA;AACAC,QAAQ,CAAC,SAACC,QAAD,QACPhC,CAAAA,CAAC,CAACiC,OAAF,CACEZ,IAAI,CAACC,KAAL,CAAWC,MAAX,CACE,SAACC,IAAD,QACE,IAAIC,CAAAA,IAAJ,CAASD,IAAI,CAACE,SAAd,GACA,GAAID,CAAAA,IAAJ,CAASE,IAAI,CAACC,KAAL,CAAWC,cAAc,CAACC,WAA1B,CAAT,CAFF,EADF,CADF,CAMEE,QANF,CAOE,QAPF,CADO,EAAD,CAAR,CAWD,CArBD,EAsBAnB,QAAQ,CAACO,EAAT,CAAY,aAAZ,CAA2B,SAAUC,IAAV,CAAgB,CACzCP,OAAO,CAACC,GAAR,CACE,uBADF,CAEEM,IAAI,CAACC,KAAL,CAAWC,MAAX,CACE,SAACC,IAAD,QACE,IAAIC,CAAAA,IAAJ,CAASD,IAAI,CAACE,SAAd,GACA,GAAID,CAAAA,IAAJ,CAASE,IAAI,CAACC,KAAL,CAAWC,cAAc,CAACC,WAA1B,CAAT,CAFF,EADF,CAFF,EAQAC,QAAQ,CAAC,SAACC,QAAD,QACPhC,CAAAA,CAAC,CAACiC,OAAF,CACEZ,IAAI,CAACC,KAAL,CAAWC,MAAX,CACE,SAACC,IAAD,QACE,IAAIC,CAAAA,IAAJ,CAASD,IAAI,CAACE,SAAd,GACA,GAAID,CAAAA,IAAJ,CAASE,IAAI,CAACC,KAAL,CAAWC,cAAc,CAACC,WAA1B,CAAT,CAFF,EADF,CADF,CAMEE,QANF,CAOE,QAPF,CADO,EAAD,CAAR,CAWD,CApBD,EAqBD,CA3EQ,CA2EN,EA3EM,CAAT,CA6EA,GAAIE,CAAAA,OAAO,CAAG7C,UAAU,EAAxB,CACA;AACA;AACA;AACA;AACA;AAlHuB,cAoHaP,QAAQ,CAAC,CAC3CqD,MAAM,CAAE,KADmC,CAE3CC,IAAI,CAAE,EAFqC,CAG3CC,KAAK,CAAE,EAHoC,CAI3CC,OAAO,CAAE,EAJkC,CAAD,CApHrB,wCAoHhBC,UApHgB,eAoHJC,aApHI,+BA0HmBxD,UAAU,CAACQ,kBAAD,CA1H7B,CA0HfiD,YA1He,aA0HfA,YA1He,CA0HDC,eA1HC,aA0HDA,eA1HC,kBA2HW1D,UAAU,CAACS,WAAD,CA3HrB,CA2HfkD,QA3He,cA2HfA,QA3He,CA2HLC,WA3HK,cA2HLA,WA3HK,CA6HvB7D,SAAS,CAAC,UAAM,CACd,GAAM8D,CAAAA,WAAW,CAAGC,MAAM,CAACC,QAAP,CAAgBC,MAApC,CACAlC,OAAO,CAACC,GAAR,CAAY,cAAZ,CAA4B8B,WAA5B,EACA,GAAI,MAAOA,CAAAA,WAAP,GAAuBI,SAAvB,EAAoCJ,WAAW,GAAK,EAAxD,CAA4D,CAC1D,GAAMK,CAAAA,SAAS,CAAG,GAAIC,CAAAA,eAAJ,CAAoBN,WAApB,CAAlB,CACA,GAAIK,SAAS,CAACE,GAAV,CAAc,SAAd,IAA6B,MAAjC,CAAyC,CACvCtC,OAAO,CAACC,GAAR,CAAY,aAAZ,CAA2BmC,SAAS,CAACE,GAAV,CAAc,SAAd,CAA3B,EACAtC,OAAO,CAACC,GAAR,CAAY,cAAZ,CAA4BmC,SAAS,CAACE,GAAV,CAAc,SAAd,CAA5B,EACAtC,OAAO,CAACC,GAAR,CAAY,YAAZ,CAA0BmC,SAAS,CAACE,GAAV,CAAc,SAAd,CAA1B,EAEA,GAAIF,SAAS,CAACE,GAAV,CAAc,SAAd,EAAyBC,QAAzB,CAAkC,KAAlC,CAAJ,CAA8C,CAC5CvC,OAAO,CAACC,GAAR,CAAY,gBAAZ,CAA8BmC,SAAS,CAACE,GAAV,CAAc,UAAd,CAA9B,EACAtC,OAAO,CAACC,GAAR,CAAY,qBAAZ,CAAmCmC,SAAS,CAACE,GAAV,CAAc,cAAd,CAAnC,EACAZ,aAAa,CAAC,CACZL,MAAM,CAAE,IADI,CAEZC,IAAI,CAAEc,SAAS,CAACE,GAAV,CAAc,cAAd,CAFM,CAGZf,KAAK,CAAEa,SAAS,CAACE,GAAV,CAAc,UAAd,CAHK,CAIZd,OAAO,CAAEY,SAAS,CAACE,GAAV,CAAc,SAAd,CAJG,CAAD,CAAb,CAMD,CACF,CAfD,IAeO,CACLtC,OAAO,CAACC,GAAR,CAAY,aAAZ,CAA2BmC,SAAS,CAACE,GAAV,CAAc,SAAd,CAA3B,EACAtC,OAAO,CAACC,GAAR,CAAY,aAAZ,CAA2BmC,SAAS,CAACE,GAAV,CAAc,SAAd,CAA3B,EACAtC,OAAO,CAACC,GAAR,CAAY,YAAZ,CAA0BmC,SAAS,CAACE,GAAV,CAAc,SAAd,CAA1B,EACA,GAAIF,SAAS,CAACE,GAAV,CAAc,SAAd,EAAyBC,QAAzB,CAAkC,KAAlC,CAAJ,CAA8C,CAC5Cb,aAAa,CAAC,CACZL,MAAM,CAAE,KADI,CAEZC,IAAI,CAAE,IAFM,CAGZC,KAAK,CAAE,IAHK,CAIZC,OAAO,CAAEY,SAAS,CAACE,GAAV,CAAc,SAAd,CAJG,CAAD,CAAb,CAMD,CACF,CACDE,UAAU,CACR,iBACEd,CAAAA,aAAa,CAAC,CAAEL,MAAM,CAAE,KAAV,CAAiBC,IAAI,CAAE,EAAvB,CAA2BC,KAAK,CAAE,EAAlC,CAAsCC,OAAO,CAAE,EAA/C,CAAD,CADf,EADQ,CAGR,KAHQ,CAAV,CAKAQ,MAAM,CAACZ,OAAP,CAAeqB,YAAf,CAA4B,EAA5B,CAAgC,IAAhC,CAAsCT,MAAM,CAACC,QAAP,CAAgBS,IAAhB,CAAqBC,KAArB,CAA2B,GAA3B,EAAgC,CAAhC,CAAtC,EACD,CACD3C,OAAO,CAACC,GAAR,CAAY,aAAZ,CAA2B4B,QAA3B,EACA,GAAIA,QAAJ,CAAc,CACZ,GAAIe,CAAAA,QAAQ,CAAGC,QAAQ,CAACC,gBAAT,CACb,0CADa,CAAf,CAGAF,QAAQ,CAAChD,OAAT,CAAiB,SAACmD,OAAD,CAAa,CAC5BA,OAAO,CAACC,KAAR,CAAcC,eAAd,CAAgC,MAAhC,CACAF,OAAO,CAACC,KAAR,CAAcE,KAAd,CAAsB,MAAtB,CACD,CAHD,EAID,CARD,IAQO,CACL,GAAIN,CAAAA,QAAQ,CAAGC,QAAQ,CAACC,gBAAT,CACb,0CADa,CAAf,CAGAF,QAAQ,CAAChD,OAAT,CAAiB,SAACmD,OAAD,CAAa,CAC5BA,OAAO,CAACC,KAAR,CAAcC,eAAd,CAAgC,MAAhC,CACAF,OAAO,CAACC,KAAR,CAAcE,KAAd,CAAsB,MAAtB,CACD,CAHD,EAID,CAEDlD,OAAO,CAACC,GAAR,CAAY,aAAZ,CAA2B4B,QAA3B,EACA,GAAIA,QAAJ,CAAc,CACZ,GAAIe,CAAAA,QAAQ,CAAGC,QAAQ,CAACC,gBAAT,CACb,0CADa,CAAf,CAGAF,QAAQ,CAAChD,OAAT,CAAiB,SAACmD,OAAD,CAAa,CAC5BA,OAAO,CAACC,KAAR,CAAcC,eAAd,CAAgC,MAAhC,CACAF,OAAO,CAACC,KAAR,CAAcE,KAAd,CAAsB,MAAtB,CACD,CAHD,EAID,CARD,IAQO,CACL,GAAIN,CAAAA,QAAQ,CAAGC,QAAQ,CAACC,gBAAT,CACb,0CADa,CAAf,CAGAF,QAAQ,CAAChD,OAAT,CAAiB,SAACmD,OAAD,CAAa,CAC5BA,OAAO,CAACC,KAAR,CAAcC,eAAd,CAAgC,MAAhC,CACAF,OAAO,CAACC,KAAR,CAAcE,KAAd,CAAsB,MAAtB,CACD,CAHD,EAID,CACF,CA7EQ,CA6EN,EA7EM,CAAT,CA7HuB,iBA4MOhF,UAAU,CAACO,aAAD,CA5MjB,CA4Mf0E,MA5Me,cA4MfA,MA5Me,CA4MPC,SA5MO,cA4MPA,SA5MO,kBA8MKlF,UAAU,CAACU,YAAD,CA9Mf,CA8Mf4B,KA9Me,cA8MfA,KA9Me,CA8MRS,QA9MQ,cA8MRA,QA9MQ,kBAgNS/C,UAAU,CAACM,YAAD,CAhNnB,6CAgNhB6E,QAhNgB,iBAgNNC,WAhNM,gCAiNOtF,QAAQ,CAAC,KAAD,CAjNf,yCAiNhBuF,UAjNgB,eAiNJC,OAjNI,eAkNvBxD,OAAO,CAACC,GAAR,CAAY,iBAAZ,EACA;AACAhC,SAAS,CAAC,UAAM,CACdK,KAAK,CACFgE,GADH,CACO,iBADP,CAC0B,CAAEmB,eAAe,CAAE,IAAnB,CAD1B,EAEGC,IAFH,2FAEQ,iBAAOC,QAAP,kHACJ5C,cAAc,CAAC6C,OAAf,CAAuB,aAAvB,CAAsC/C,IAAI,CAACgD,SAAL,CAAe,GAAIlD,CAAAA,IAAJ,EAAf,CAAtC,EACA,GAAIgD,QAAQ,CAACpD,IAAT,CAAcuD,OAAlB,CAA2B,CACzB9D,OAAO,CAACC,GAAR,CAAY,YAAZ,CAA0B0D,QAAQ,CAACpD,IAAnC,EACA,GAAIoD,QAAQ,CAACpD,IAAT,CAAc4C,MAAd,CAAqBY,MAArB,CAA8B,CAAlC,CAAqC,CACnCX,SAAS,CAACO,QAAQ,CAACpD,IAAT,CAAc4C,MAAf,CAAT,CACA;AACAlC,QAAQ,CACN0C,QAAQ,CAACpD,IAAT,CAAc4C,MAAd,CACGa,GADH,CACO,mBAAGxD,CAAAA,KAAH,OAAGA,KAAH,OAAeA,CAAAA,KAAf,EADP,EAEGyD,IAFH,GAGGC,IAHH,CAGQ,SAAUC,CAAV,CAAaC,CAAb,CAAgB,CACpB,MAAO,IAAIzD,CAAAA,IAAJ,CAASyD,CAAC,CAACxD,SAAX,EAAwB,GAAID,CAAAA,IAAJ,CAASwD,CAAC,CAACvD,SAAX,CAA/B,CACD,CALH,EAMGoD,GANH,CAMO,SAACtD,IAAD,CAAU,CACb,GAAIA,IAAI,CAAC2D,cAAL,CAAoB9B,QAApB,CAA6B,WAA7B,CAAJ,CAA+C,CAC7C,GAAI+B,CAAAA,WAAW,CAAG5D,IAAI,CAAC6D,QAAL,CAAc5B,KAAd,CAAoB,GAApB,CAAlB,CACA,GAAI6B,CAAAA,QAAQ,CAAGF,WAAW,CACxBA,WAAW,CAACP,MAAZ,CAAqB,CADG,CAAX,CAEbU,WAFa,EAAf,CAIA,GAAI,MAAO/E,CAAAA,kBAAkB,CAAC8E,QAAD,CAAzB,GAAwC,WAA5C,CAAyD,CACvD9D,IAAI,CAAC2D,cAAL,CAAsB3E,kBAAkB,CAAC8E,QAAD,CAAxC,CACD,CAFD,IAEO,CACL9D,IAAI,CAAC2D,cAAL,CAAsB,QAAtB,CACD,CACF,CACD,MAAO3D,CAAAA,IAAP,CACD,CApBH,CADM,CAAR,CAuBD,CA1BD,IA0BO,CACL0C,SAAS,CAAC,EAAD,CAAT,CACD,CACF,CA/BD,IA+BO,CACLhC,OAAO,CAACsD,IAAR,CAAa,GAAb,EACD,CAnCG,sDAFR,iEAuCGC,KAvCH,CAuCS,SAACC,KAAD,CAAW,CAChB5E,OAAO,CAACC,GAAR,CAAY2E,KAAZ,EACD,CAzCH,EA0CD,CA3CQ,CA2CN,EA3CM,CAAT,CA6CA,GAAMC,CAAAA,aAAa,CAAG,QAAhBA,CAAAA,aAAgB,EAAM,CAC1BrB,OAAO,CAAC,IAAD,CAAP,CACD,CAFD,CAGA,GAAMsB,CAAAA,sBAAsB,CAAG,QAAzBA,CAAAA,sBAAyB,EAAM,CACnCtB,OAAO,CAAC,KAAD,CAAP,CACD,CAFD,CAGA,mBACE,4CACE,oBAAC,MAAD,MADF,CAGGH,QAAQ,CAAChC,MAAT,eACC,2BAAK,SAAS,CAAC,iBAAf,eACE,2BAAK,SAAS,CAAC,KAAf,CAAqB,KAAK,CAAE,CAAE0D,UAAU,CAAE,IAAd,CAA5B,eACE,2BAAK,SAAS,CAAC,UAAf,CAA0B,KAAK,CAAE,CAAEC,OAAO,CAAE,GAAX,CAAjC,eACE,oBAAC,SAAD,MADF,CADF,cAIE,2BAAK,SAAS,CAAC,UAAf,eACE,oBAAC,QAAD,MADF,cAEE,8BAFF,CAGGvD,UAAU,CAACJ,MAAX,cACC,yBACE,KAAK,CAAE,CACL4B,eAAe,CAAE,OADZ,CAELC,KAAK,CAAE,MAFF,CAGL+B,QAAQ,CAAE,QAHL,CAILC,MAAM,CAAE,IAJH,CAKLF,OAAO,CAAE,IALJ,CADT,EASG,GATH,CAUGvD,UAAU,CAACH,IAVd,YAU4BG,UAAU,CAACF,KAVvC,wBADD,CAcGE,UAAU,CAACD,OAAX,CAAmBuC,MAAnB,CAA4B,CAA5B,cACF,yBACE,KAAK,CAAE,CACLd,eAAe,CAAE,KADZ,CAELC,KAAK,CAAE,MAFF,CAGL+B,QAAQ,CAAE,QAHL,CAILC,MAAM,CAAE,IAJH,CAKLF,OAAO,CAAE,IALJ,CADT,EASG,GATH,CAUGvD,UAAU,CAACD,OAVd,CADE,CAaA,IA9BN,cA+BE,8BA/BF,CAgCGG,YAAY,CAACN,MAAb,cACC,yBACE,KAAK,CAAE,CACL4B,eAAe,CAAE,OADZ,CAELC,KAAK,CAAE,MAFF,CAGL+B,QAAQ,CAAE,QAHL,CAILC,MAAM,CAAE,IAJH,CAKLF,OAAO,CAAE,IALJ,CADT,EASG,GATH,8BADD,CAaGrD,YAAY,CAACH,OAAb,CAAqBuC,MAArB,CAA8B,CAA9B,cACF,yBACE,KAAK,CAAE,CACLd,eAAe,CAAE,KADZ,CAELC,KAAK,CAAE,MAFF,CAGL+B,QAAQ,CAAE,QAHL,CAILC,MAAM,CAAE,IAJH,CAKLF,OAAO,CAAE,IALJ,CADT,EASG,GATH,CAUGrD,YAAY,CAACH,OAVhB,CADE,CAaA,IA1DN,CAJF,cAgEE,2BAAK,SAAS,CAAC,UAAf,eACE,oBAAC,SAAD,MADF,cAEE,2BAAK,SAAS,CAAC,YAAf,CAA4B,KAAK,CAAE,CAAE2D,SAAS,CAAE,IAAb,CAAnC,eACE,8BAAQ,SAAS,CAAC,cAAlB,CAAiC,OAAO,CAAEN,aAA1C,EACG,GADH,eADF,CAFF,cAQE,oBAAC,UAAD,EACE,IAAI,CAAEtB,UADR,CAEE,WAAW,CAAEuB,sBAFf,EARF,CAhEF,CADF,CAJJ,cAqFE,oBAAC,MAAD,MArFF,CADF,CAyFD,CAED,cAAe1F,CAAAA,IAAf","sourcesContent":["import React, { useState, useEffect, useContext, Component } from \"react\";\nimport Header from \"./Header\";\nimport Footer from \"./Footer\";\nimport axios from \"axios\";\nimport { useHistory } from \"react-router-dom\";\nimport { LoginContext } from \"./LoginContext\";\nimport { DrivesContext, DriveDeleteContext } from \"./DrivesRepo\";\nimport { DarkContext } from \"./SearchContext\";\nimport { FilesContext } from \"./FilesRepo\";\nimport FileList from \"./FileList\";\nimport DriveList from \"./DriveList\";\nimport AddDrives from \"./AddDrives\";\nimport FileUpload from \"./FileUpload\";\nimport classNames from \"classnames\";\nimport _ from \"lodash\";\nimport sockIO from \"socket.io-client\";\n\nfunction Home({ match }) {\n  const backEndPort = \"http://localhost:3000\";\n  // let backEndPort;\n  // if (process.env.NODE_ENV === \"production\") {\n  //   backEndPort = \"https://desolate-bastion-47247.herokuapp.com/\";\n  // } else {\n  //   backEndPort = \"http://localhost:3000\";\n  // }\n\n  const customSwitchClass = classNames(\"custom-control\", \"custom-switch\");\n  const mimeSuffixName = [\n    \"octet-stream\",\n    \"vnd.google-apps.spreadsheet\",\n    \"vnd.google-apps.document\",\n    \"vnd.google-apps.presentation\",\n    \"pdf\",\n  ];\n  const mimeSuffixValue = [\n    \"Plain\",\n    \"Spreadsheet\",\n    \"WordDocument\",\n    \"PowerPoint\",\n    \"PDF\",\n  ];\n  const mimeSuffixMappings = new Object();\n\n  useEffect(() => {\n    mimeSuffixName.forEach((item, index) => {\n      mimeSuffixMappings[item] = mimeSuffixValue[index];\n    });\n  }, []);\n\n  useEffect(() => {\n    let socketIO;\n    console.log(\"environment :\", process.env.NODE_ENV);\n    // if (process.env.NODE_ENV === \"production\") {\n    //   socketIO = sockIO.connect();\n    // } else {\n    //   socketIO = sockIO.connect(backEndPort);\n    // }\n    socketIO = sockIO.connect(backEndPort);\n    console.log(\"socket is :\", socketIO);\n    socketIO.on(\"oneDriveFiles\", function (data) {\n      console.log(\n        \"Incoming onedriveFiles:\",\n        data.files.filter(\n          (file) =>\n            new Date(file.createdAt) >=\n            new Date(JSON.parse(sessionStorage.lastFetchDt))\n        )\n      );\n      // console.log(\"lastFetchedDt\",JSON.parse(sessionStorage.getItem(\"lastFetchDt\")));\n      setFiles((oldFiles) =>\n        _.unionBy(\n          data.files.filter(\n            (file) =>\n              new Date(file.createdAt) >=\n              new Date(JSON.parse(sessionStorage.lastFetchDt))\n          ),\n          oldFiles,\n          \"fileId\"\n        )\n      );\n    });\n    socketIO.on(\"dbxFiles\", function (data) {\n      console.log(\n        \"Incoming dbxFiles:\",\n        data.files.filter(\n          (file) =>\n            new Date(file.createdAt) >=\n            new Date(JSON.parse(sessionStorage.lastFetchDt))\n        )\n      );\n      // console.log(\"last fetch dt\",JSON.parse(sessionStorage.lastFetchDt));\n      setFiles((oldFiles) =>\n        _.unionBy(\n          data.files.filter(\n            (file) =>\n              new Date(file.createdAt) >=\n              new Date(JSON.parse(sessionStorage.lastFetchDt))\n          ),\n          oldFiles,\n          \"fileId\"\n        )\n      );\n    });\n    socketIO.on(\"googleFiles\", function (data) {\n      console.log(\n        \"Incoming googleFiles:\",\n        data.files.filter(\n          (file) =>\n            new Date(file.createdAt) >=\n            new Date(JSON.parse(sessionStorage.lastFetchDt))\n        )\n      );\n      setFiles((oldFiles) =>\n        _.unionBy(\n          data.files.filter(\n            (file) =>\n              new Date(file.createdAt) >=\n              new Date(JSON.parse(sessionStorage.lastFetchDt))\n          ),\n          oldFiles,\n          \"fileId\"\n        )\n      );\n    });\n  }, []);\n\n  let history = useHistory();\n  // if (window.location.hash === \"#_=_\") {\n  //   history.replaceState\n  //     ? history.replaceState(null, null, window.location.href.split(\"#\")[0])\n  //     : (window.location.hash = \"\");\n  // }\n\n  const [driveAdded, setDriveAdded] = useState({\n    status: false,\n    type: \"\",\n    email: \"\",\n    message: \"\",\n  });\n  const { driveDeleted, setDriveDeleted } = useContext(DriveDeleteContext);\n  const { darkMode, setDarkMode } = useContext(DarkContext);\n\n  useEffect(() => {\n    const queryString = window.location.search;\n    console.log(\"queryString:\", queryString);\n    if (typeof queryString !== undefined && queryString !== \"\") {\n      const urlParams = new URLSearchParams(queryString);\n      if (urlParams.get(\"success\") === \"true\") {\n        console.log(\"status is: \", urlParams.get(\"success\"));\n        console.log(\"attempt is: \", urlParams.get(\"attempt\"));\n        console.log(\"message : \", urlParams.get(\"message\"));\n\n        if (urlParams.get(\"attempt\").includes(\"add\")) {\n          console.log(\"new Drive is: \", urlParams.get(\"newDrive\"));\n          console.log(\"new Drive type is: \", urlParams.get(\"newDriveType\"));\n          setDriveAdded({\n            status: true,\n            type: urlParams.get(\"newDriveType\"),\n            email: urlParams.get(\"newDrive\"),\n            message: urlParams.get(\"message\"),\n          });\n        }\n      } else {\n        console.log(\"status is: \", urlParams.get(\"success\"));\n        console.log(\"status is: \", urlParams.get(\"attempt\"));\n        console.log(\"message : \", urlParams.get(\"message\"));\n        if (urlParams.get(\"attempt\").includes(\"add\")) {\n          setDriveAdded({\n            status: false,\n            type: \"NA\",\n            email: \"NA\",\n            message: urlParams.get(\"message\"),\n          });\n        }\n      }\n      setTimeout(\n        () =>\n          setDriveAdded({ status: false, type: \"\", email: \"\", message: \"\" }),\n        10000\n      );\n      window.history.replaceState({}, null, window.location.href.split(\"?\")[0]);\n    }\n    console.log(\"dark mode: \", darkMode);\n    if (darkMode) {\n      var elements = document.querySelectorAll(\n        \"body,.card,.list-group-item,.tooltiptext\"\n      );\n      elements.forEach((element) => {\n        element.style.backgroundColor = \"#000\";\n        element.style.color = \"#fff\";\n      });\n    } else {\n      var elements = document.querySelectorAll(\n        \"body,.card,.list-group-item,.tooltiptext\"\n      );\n      elements.forEach((element) => {\n        element.style.backgroundColor = \"#fff\";\n        element.style.color = \"#000\";\n      });\n    }\n\n    console.log(\"dark mode: \", darkMode);\n    if (darkMode) {\n      var elements = document.querySelectorAll(\n        \"body,.card,.list-group-item,.tooltiptext\"\n      );\n      elements.forEach((element) => {\n        element.style.backgroundColor = \"#000\";\n        element.style.color = \"#fff\";\n      });\n    } else {\n      var elements = document.querySelectorAll(\n        \"body,.card,.list-group-item,.tooltiptext\"\n      );\n      elements.forEach((element) => {\n        element.style.backgroundColor = \"#fff\";\n        element.style.color = \"#000\";\n      });\n    }\n  }, []);\n\n  const { drives, setDrives } = useContext(DrivesContext);\n\n  const { files, setFiles } = useContext(FilesContext);\n\n  const [loggedIn, setLoggedIn] = useContext(LoginContext);\n  const [showUpload, setShow] = useState(false);\n  console.log(\" user home page\");\n  // const { params: { userName } = {} } = match;\n  useEffect(() => {\n    axios\n      .get(\"/user/data/read\", { withCredentials: true })\n      .then(async (response) => {\n        sessionStorage.setItem(\"lastFetchDt\", JSON.stringify(new Date()));\n        if (response.data.success) {\n          console.log(\"response: \", response.data);\n          if (response.data.drives.length > 0) {\n            setDrives(response.data.drives);\n            // console.log(\"files received:\",response.data.drives.map(({ files }) => files).flat());\n            setFiles(\n              response.data.drives\n                .map(({ files }) => files)\n                .flat()\n                .sort(function (a, b) {\n                  return new Date(b.createdAt) - new Date(a.createdAt);\n                })\n                .map((file) => {\n                  if (file.fileFolderType.includes(\"undefined\")) {\n                    let mimeSuffArr = file.mimeType.split(\"/\");\n                    let mimeSuff = mimeSuffArr[\n                      mimeSuffArr.length - 1\n                    ].toLowerCase();\n\n                    if (typeof mimeSuffixMappings[mimeSuff] !== \"undefined\") {\n                      file.fileFolderType = mimeSuffixMappings[mimeSuff];\n                    } else {\n                      file.fileFolderType = \"Others\";\n                    }\n                  }\n                  return file;\n                })\n            );\n          } else {\n            setDrives([]);\n          }\n        } else {\n          history.push(\"/\");\n        }\n      })\n      .catch((error) => {\n        console.log(error);\n      });\n  }, []);\n\n  const triggerUpload = () => {\n    setShow(true);\n  };\n  const handleUploadModalClose = () => {\n    setShow(false);\n  };\n  return (\n    <div>\n      <Header />\n\n      {loggedIn.status && (\n        <div className=\"container-fluid\">\n          <div className=\"row\" style={{ paddingTop: \"2%\" }}>\n            <div className=\"col-sm-2\" style={{ padding: \"0\" }}>\n              <DriveList />\n            </div>\n            <div className=\"col-sm-8\">\n              <FileList />\n              <br />\n              {driveAdded.status ? (\n                <p\n                  style={{\n                    backgroundColor: \"green\",\n                    color: \"#fff\",\n                    fontSize: \"medium\",\n                    margin: \"2%\",\n                    padding: \"2%\",\n                  }}\n                >\n                  {\" \"}\n                  {driveAdded.type} drive ({driveAdded.email}) added\n                  successfully\n                </p>\n              ) : driveAdded.message.length > 0 ? (\n                <p\n                  style={{\n                    backgroundColor: \"red\",\n                    color: \"#fff\",\n                    fontSize: \"medium\",\n                    margin: \"2%\",\n                    padding: \"2%\",\n                  }}\n                >\n                  {\" \"}\n                  {driveAdded.message}\n                </p>\n              ) : null}\n              <br />\n              {driveDeleted.status ? (\n                <p\n                  style={{\n                    backgroundColor: \"green\",\n                    color: \"#fff\",\n                    fontSize: \"medium\",\n                    margin: \"2%\",\n                    padding: \"2%\",\n                  }}\n                >\n                  {\" \"}\n                  Drive removed successfully\n                </p>\n              ) : driveDeleted.message.length > 0 ? (\n                <p\n                  style={{\n                    backgroundColor: \"red\",\n                    color: \"#fff\",\n                    fontSize: \"medium\",\n                    margin: \"2%\",\n                    padding: \"2%\",\n                  }}\n                >\n                  {\" \"}\n                  {driveDeleted.message}\n                </p>\n              ) : null}\n            </div>\n            <div className=\"col-sm-2\">\n              <AddDrives />\n              <div className=\"cardHeader\" style={{ marginTop: \"2%\" }}>\n                <button className=\"uploadButton\" onClick={triggerUpload}>\n                  {\" \"}\n                  Upload File\n                </button>\n              </div>\n              <FileUpload\n                show={showUpload}\n                handleClose={handleUploadModalClose}\n              />\n            </div>\n          </div>\n        </div>\n      )}\n      <Footer />\n    </div>\n  );\n}\n\nexport default Home;\n"]},"metadata":{},"sourceType":"module"}