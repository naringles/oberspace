"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react");require("prop-types");var t=require("@reach/utils"),n=require("@reach/descendants"),a=require("highlight-words-core"),r=require("@reach/auto-id"),o=require("@reach/popover");function u(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var i,l,c,s,d,f=u(e),v=u(o);function E(){return(E=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function p(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)t.indexOf(n=o[a])>=0||(r[n]=e[n]);return r}var C="IDLE",b="SUGGESTING",T="NAVIGATING",x="INTERACTING",I={initial:C,states:(d={},d.IDLE={on:(i={},i.BLUR=C,i.CLEAR=C,i.CHANGE=b,i.INITIAL_CHANGE=C,i.FOCUS=b,i.NAVIGATE=T,i.OPEN_WITH_BUTTON=b,i)},d[b]={on:(l={},l.CHANGE=b,l.FOCUS=b,l.NAVIGATE=T,l.CLEAR=C,l.ESCAPE=C,l.BLUR=C,l.SELECT_WITH_CLICK=C,l.INTERACT=x,l.CLOSE_WITH_BUTTON=C,l)},d[T]={on:(c={},c.CHANGE=b,c.FOCUS=b,c.CLEAR=C,c.BLUR=C,c.ESCAPE=C,c.NAVIGATE=T,c.SELECT_WITH_CLICK=C,c.SELECT_WITH_KEYBOARD=C,c.CLOSE_WITH_BUTTON=C,c.INTERACT=x,c)},d[x]={on:(s={},s.CLEAR=C,s.CHANGE=b,s.FOCUS=b,s.BLUR=C,s.ESCAPE=C,s.NAVIGATE=T,s.CLOSE_WITH_BUTTON=C,s.SELECT_WITH_CLICK=C,s)},d)},A=function(e,t){var n=E({},e,{lastEventType:t.type});switch(t.type){case"CHANGE":case"INITIAL_CHANGE":return E({},n,{navigationValue:null,value:t.value});case"NAVIGATE":case"OPEN_WITH_BUTTON":return E({},n,{navigationValue:g(n,t)});case"CLEAR":return E({},n,{value:"",navigationValue:null});case"BLUR":case"ESCAPE":return E({},n,{navigationValue:null});case"SELECT_WITH_CLICK":return E({},n,{value:t.value,navigationValue:null});case"SELECT_WITH_KEYBOARD":return E({},n,{value:e.navigationValue,navigationValue:null});case"CLOSE_WITH_BUTTON":return E({},n,{navigationValue:null});case"INTERACT":return n;case"FOCUS":return E({},n,{navigationValue:g(n,t)});default:return n}};function h(e){return[b,T,x].includes(e)}function g(e,t){return t.value?t.value:t.persistSelection?e.value:null}var m=n.createDescendantContext("ComboboxDescendantContext"),R=t.createNamedContext("ComboboxContext",{}),N=t.createNamedContext("OptionContext",{}),O=t.forwardRefWithAs((function(a,o){var u=a.onSelect,i=a.openOnFocus,l=void 0!==i&&i,c=a.children,s=a.as,d=void 0===s?"div":s,v=a["aria-label"],C=a["aria-labelledby"],b=p(a,["onSelect","openOnFocus","children","as","aria-label","aria-labelledby"]),T=n.useDescendantsInit(),x=T[0],g=T[1],N=e.useRef(),O=e.useRef(),S=e.useRef(),L=e.useRef(),_=e.useRef(),w=function(t,n,a){var r=e.useState(t.initial),o=r[0],u=r[1],i=e.useReducer(n,{value:"",navigationValue:null}),l=i[1];return[o,i[0],function(e,n){void 0===n&&(n={});var a=t.states[o],r=a&&a.on[e];if(r)return l(E({type:e,state:o,nextState:o},n)),void u(r)}]}(I,A),y=w[0],H=w[1],G=w[2];!function(e,n){t.useIsomorphicLayoutEffect((function(){"NAVIGATE"!==e&&"ESCAPE"!==e&&"SELECT_WITH_CLICK"!==e&&"OPEN_WITH_BUTTON"!==e||n.current.focus()}),[n,e])}(H.lastEventType,N);var D=r.useId(b.id),V=D?t.makeId("listbox",D):"listbox",k={ariaLabel:v,ariaLabelledby:C,autocompletePropRef:L,buttonRef:S,comboboxId:D,data:H,inputRef:N,isExpanded:h(y),listboxId:V,onSelect:u||t.noop,openOnFocus:l,persistSelectionRef:_,popoverRef:O,state:y,transition:G};return e.useEffect((function(){return t.checkStyles("combobox")}),[]),f.default.createElement(n.DescendantProvider,{context:m,items:x,set:g},f.default.createElement(R.Provider,{value:k},f.default.createElement(d,Object.assign({},b,{"data-reach-combobox":"",ref:o}),t.isFunction(c)?c({id:D,isExpanded:h(y)}):c)))})),S=t.forwardRefWithAs((function(n,a){var r=n.as,o=void 0===r?"input":r,u=n.selectOnClick,i=void 0!==u&&u,l=n.autocomplete,c=void 0===l||l,s=n.onClick,d=n.onChange,v=n.onKeyDown,E=n.onBlur,C=n.onFocus,b=n.value,I=p(n,["as","selectOnClick","autocomplete","onClick","onChange","onKeyDown","onBlur","onFocus","value"]),A=e.useRef(b).current,h=e.useRef(!1);t.useUpdateEffect((function(){h.current=!0}),[b]);var g=e.useContext(R),m=g.data,N=m.navigationValue,O=m.value,S=m.lastEventType,L=g.inputRef,_=g.state,w=g.transition,y=g.listboxId,H=g.autocompletePropRef,k=g.openOnFocus,W=g.isExpanded,B=g.ariaLabel,U=g.ariaLabelledby,P=t.useForkedRef(L,a),F=e.useRef(!1),K=G(),j=D(),q=null!=b;t.useIsomorphicLayoutEffect((function(){H.current=c}),[c,H]);var M=e.useCallback((function(e){""===e.trim()?w("CLEAR"):w(e!==A||h.current?"CHANGE":"INITIAL_CHANGE",{value:e})}),[A,w]);e.useEffect((function(){!q||b===O||""===b.trim()&&""===(O||"").trim()||M(b)}),[b,M,q,O]);var Y=!c||_!==T&&_!==x?b||O:N||b||O;return f.default.createElement(o,Object.assign({"aria-activedescendant":N?String(V(N)):void 0,"aria-autocomplete":"both","aria-controls":y,"aria-expanded":W,"aria-haspopup":"listbox","aria-label":B,"aria-labelledby":B?void 0:U,role:"combobox"},I,{"data-reach-combobox-input":"",ref:P,onBlur:t.wrapEvent(E,j),onChange:t.wrapEvent(d,(function(e){q||M(e.target.value)})),onClick:t.wrapEvent(s,(function(){F.current&&(F.current=!1,L.current.select())})),onFocus:t.wrapEvent(C,(function(){i&&(F.current=!0),k&&"SELECT_WITH_CLICK"!==S&&w("FOCUS")})),onKeyDown:t.wrapEvent(v,K),value:Y||""}))})),L=e.forwardRef((function(n,a){var r=n.children,u=n.portal,i=void 0===u||u,l=n.onKeyDown,c=n.onBlur,s=n.position,d=void 0===s?o.positionMatchWidth:s,E=p(n,["children","portal","onKeyDown","onBlur","position"]),C=e.useContext(R),b=C.inputRef,T=C.isExpanded,x=t.useForkedRef(C.popoverRef,a),I=G(),A=D(),h={"data-reach-combobox-popover":"",onKeyDown:t.wrapEvent(l,I),onBlur:t.wrapEvent(c,A),hidden:!T,tabIndex:-1,children:r};return i?f.default.createElement(v.default,Object.assign({},E,{ref:x,position:d,targetRef:b},h)):f.default.createElement("div",Object.assign({ref:x},E,h))})),_=t.forwardRefWithAs((function(t,n){var a=t.persistSelection,r=void 0!==a&&a,o=t.as,u=void 0===o?"ul":o,i=p(t,["persistSelection","as"]),l=e.useContext(R),c=l.listboxId;return r&&(l.persistSelectionRef.current=!0),f.default.createElement(u,Object.assign({role:"listbox"},i,{ref:n,"data-reach-combobox-list":"",id:c}))})),w=t.forwardRefWithAs((function(a,r){var o=a.as,u=void 0===o?"li":o,i=a.children,l=a.value,c=a.onClick,s=p(a,["as","children","value","onClick"]),d=e.useContext(R),v=d.onSelect,E=d.data.navigationValue,C=d.transition,b=e.useRef(null),T=t.useForkedRef(r,b),x=n.useDescendant({element:b.current,value:l},m),I=E===l;return f.default.createElement(N.Provider,{value:{value:l,index:x}},f.default.createElement(u,Object.assign({"aria-selected":I,role:"option"},s,{"data-reach-combobox-option":"",ref:T,id:String(V(l)),"data-highlighted":I?"":void 0,tabIndex:-1,onClick:t.wrapEvent(c,(function(){v&&v(l),C("SELECT_WITH_CLICK",{value:l})})),children:i||f.default.createElement(y,null)})))}));function y(){var t=e.useContext(N).value,n=e.useContext(R).data.value,r=e.useMemo((function(){return a.findAll({searchWords:k(n||"").split(/\s+/),textToHighlight:t})}),[n,t]);return f.default.createElement(f.default.Fragment,null,r.length?r.map((function(e,n){var a=t.slice(e.start,e.end);return f.default.createElement("span",{key:n,"data-user-value":!!e.highlight||void 0,"data-suggested-value":!e.highlight||void 0},a)})):t)}var H=t.forwardRefWithAs((function(n,a){var r=n.as,o=void 0===r?"button":r,u=n.onClick,i=n.onKeyDown,l=p(n,["as","onClick","onKeyDown"]),c=e.useContext(R),s=c.transition,d=c.state,v=c.listboxId,E=c.isExpanded,b=t.useForkedRef(c.buttonRef,a),T=G();return f.default.createElement(o,Object.assign({"aria-controls":v,"aria-haspopup":"listbox","aria-expanded":E},l,{"data-reach-combobox-button":"",ref:b,onClick:t.wrapEvent(u,(function(){s(d===C?"OPEN_WITH_BUTTON":"CLOSE_WITH_BUTTON")})),onKeyDown:t.wrapEvent(i,T)}))}));function G(){var t=e.useContext(R),a=t.data.navigationValue,r=t.onSelect,o=t.state,u=t.transition,i=t.autocompletePropRef,l=t.persistSelectionRef,c=n.useDescendants(m);return function(e){var t=c.findIndex((function(e){return e.value===a}));function n(){return c[0]}function s(){return c[c.length-1]}switch(e.key){case"ArrowDown":if(e.preventDefault(),!c||!c.length)return;if(o===C)u("NAVIGATE",{persistSelection:l.current});else{var d=t===c.length-1?i.current?null:n():c[(t+1)%c.length];u("NAVIGATE",{value:d?d.value:null})}break;case"ArrowUp":if(e.preventDefault(),!c||0===c.length)return;if(o===C)u("NAVIGATE");else{var f=0===t?i.current?null:s():-1===t?s():c[(t-1+c.length)%c.length];u("NAVIGATE",{value:f?f.value:null})}break;case"Home":case"PageUp":if(e.preventDefault(),!c||0===c.length)return;o===C?u("NAVIGATE"):u("NAVIGATE",{value:n().value});break;case"End":case"PageDown":if(e.preventDefault(),!c||0===c.length)return;o===C?u("NAVIGATE"):u("NAVIGATE",{value:s().value});break;case"Escape":o!==C&&u("ESCAPE");break;case"Enter":o===T&&null!==a&&(e.preventDefault(),r&&r(a),u("SELECT_WITH_KEYBOARD"))}}}function D(){var n=e.useContext(R),a=n.state,r=n.transition,o=n.popoverRef,u=n.inputRef,i=n.buttonRef;return function(){var e=t.getOwnerDocument(u.current)||document;requestAnimationFrame((function(){e.activeElement!==u.current&&e.activeElement!==i.current&&o.current&&(o.current.contains(e.activeElement)?a!==x&&r("INTERACT"):r("BLUR"))}))}}var V=function(e){var t=0;if(0===e.length)return t;for(var n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t&=t;return t};function k(e){return String(e).replace(/([.*+?=^!:${}()|[\]/\\])/g,"\\$1")}exports.Combobox=O,exports.ComboboxButton=H,exports.ComboboxInput=S,exports.ComboboxList=_,exports.ComboboxOption=w,exports.ComboboxOptionText=y,exports.ComboboxPopover=L,exports.escapeRegexp=k,exports.useComboboxContext=function(){var t=e.useContext(R),n=t.isExpanded,a=t.comboboxId;return e.useMemo((function(){return{id:a,isExpanded:n}}),[a,n])};
//# sourceMappingURL=combobox.cjs.production.min.js.map
